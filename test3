var jsonic = require('jsonic');
input = 'x=[1, "hello \\"don\'t [1,2,3] {a=b y=a}there", \'this\\\' "that" then\', {a=b, y=h}] y=z \'some word\'=[1,2,[1,2,[1,2,3]]]'

function jason(input) {
	var output = '{';
	var singleQuotes = false 
	var doubleQuotes = false;

	input.split('').forEach(function(char, pos){ 
		char = char == '=' && !singleQuotes && !doubleQuotes ? ':' : char; // replace = with :

		// add commas
		if(!singleQuotes && !doubleQuotes && char == ' ' && input[pos - 1] != ',') {
			if(output[output.length - 1] != ',') char = ',';
		}

		// handle single/double quotes escaping
		if(singleQuotes && char == '\\' && input[pos + 1] == "'") char = '';
		if(singleQuotes && char == '"') output += '\\';

		if(char == '"' && input[pos - 1] != '\\' && !singleQuotes) doubleQuotes = !doubleQuotes;
		if(char == "'" && input[pos - 1] != '\\' && !doubleQuotes) {
			singleQuotes = !singleQuotes;
			char = '"';
		}

		output += char;
	});

	return output + '}';
}

console.log(output);
//console.log(JSON.stringify(jsonic(output), null, 4));
console.log(jsonic(output).x[2]);
